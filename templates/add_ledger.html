{% extends "layout.html" %} {% block title %} Add Ledger {% endblock %} {% block main %}
<div class="ui container">
  <br>
  <h2 class="ui header">
    <i class="address card icon"></i>
    <div class="content">
      New Ledger
    </div>
  </h2>
  <div class="ui horizontal divider">
    Create New
  </div>
  <form class="ui form" action="" method="post" onsubmit="return check()">
    <div class="ui grid">

      <div class="eight wide column">
        <div class="field">
          <label>Ledger Name</label>
          <input type="text" name="ledger_name" value="" placeholder="Ledger Name" autocomplete="off" required>
        </div>
        <div class="field">
          <label>GSTIN</label>
          <input type="text" autocomplete="off" name="gstin" pattern="[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z][1-9][A-Z][0-9A-Z]$" id="gstin" placeholder="GSTIN (if any)">
        </div>
      </div>

      <div class="four wide column">
        <div class="field">
          <label>Place</label> {% include 'state_name_select.html' %}
        </div>
        <div class="field">
          <div class="ui checkbox">
            <input type="checkbox" name="sez" value="True">
            <label>Special Economic Zone</label>
          </div>
        </div>
        <div class="field">
          <div class="ui checkbox">
            <input type="checkbox" name="comp" value="True">
            <label>Composition Scheme</label>
          </div>
        </div>
        <div class="field">
          <div class="ui checkbox">
            <input type="checkbox" name="ur" value="True">
            <label>Un-registered Dealer</label>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="eight wide column">
          <div class="field">
            <button class="ui primary button"> Save </button>
          </div>
        </div>
      </div>
    </div>

  </form>

</div>

<script type="text/javascript">
  function check() {
    gstin = (document.getElementsByName('gstin')[0].value)
    console.log(!(gstin[0] == '1' && gstin[1] == '9'));

    if (gstin == "") {
      // gstin is empty
      if (!document.getElementsByName('ur')[0].checked) {
        // Unregistered unchecked
        showMessage("No GSTIN provided", `Please Provide GSTIN <br />OR <br /> Select Unregistered Dealer`);
        return false;
      } else {
        // Unregistered ledger
        if (document.getElementsByName('pos')[0].value == '') {
          // POS not given
          //console.log('No POS');
          showMessage("No Place of Supply Provided",'Please Provide Place of Supply');
          return false;
        }
        return true;
      }
    } else {
      // gstin not empty
      document.getElementsByName('ur')[0].checked = false
      document.getElementsByName('pos')[0].value = gstin[0]+gstin[1]
    }
    gstinwocd = gstin.substring(0, gstin.length - 1).split("")
    cpChars = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("")

    factor = 2
    sum = 0
    checkCodePoint = 0
    mod = cpChars.length

    for (i = gstinwocd.length - 1; i >= 0; i--) {
      codePoint = -1
      for (j = 0; j < cpChars.length; j++) {
        if (cpChars[j] == gstinwocd[i]) {
          codePoint = j;
        }
      }
      digit = parseInt(factor * codePoint)
      factor = (factor == 2) ? 1 : 2
      digit = parseInt(digit / mod) + parseInt(digit % mod)
      sum += parseInt(digit)
    }
    checkCodePoint = parseInt((mod - (sum % mod)) % mod)
    checkdigit = cpChars[checkCodePoint]
    //console.log()
    console.log(checkdigit);
    if (checkdigit != gstin[gstin.length - 1]) {

      showMessage("GSTIN Checksum Mismatch", "Recheck GSTIN")
      return false;
    }
    return true;

  }
</script>










{% endblock %}
